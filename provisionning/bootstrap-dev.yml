---
- hosts: localhost
  become: yes

  tasks:

    - name: install tox
      pip:
        name="tox"
        state=latest
    
    - name: creating tox environment
      shell: >
        tox -r -e {{ ansible_env.ENV_NAME }}
      args:
        chdir: "{{ ansible_env.APP_PATH }}"
        creates: "{{ ansible_env.VIRTUAL_ENV_PATH }}"
    
    - name: creating bucket using boto library
      shell: "{{ ansible_env.VIRTUAL_ENV_PATH }}/bin/python {{ ansible_env.APP_PATH }}/scripts/create_bucket.py"
      args:
        chdir: "{{ ansible_env.APP_PATH }}"

    - name: enable virtualenv and fix destination directory when SSH
      lineinfile:
        dest=/home/vagrant/.zshrc
        line="source /tmp/virtual_env34/bin/activate && cd $APP_PATH"
        insertafter=EOF
